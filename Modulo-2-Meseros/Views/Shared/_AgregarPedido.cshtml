@using System.Security.Claims
@model Modulo_2_Meseros.Models.PedidoCreacion
@{
    var idMesa = Context.Request.Query["idMesa"].ToString();
    var estaOcupada = Context.Request.Query["estaOcupada"].ToString();
}

<script>
    document.addEventListener('DOMContentLoaded', function() {
    @if (estaOcupada == "false")
    {
        <text>
                // Auto-enviar el formulario cuando la vista se carga
                document.getElementById('pedidoForm').submit();
        </text>
    }
    });
</script>

<form id="pedidoForm" asp-action="AgregarPedido" method="post" style="display:none;">
    <input type="hidden" name="Pedido.IdMesa" value="@idMesa" />
    <input type="hidden" name="Pedido.EmpleadoID" value="@(User.FindFirstValue(ClaimTypes.NameIdentifier) ?? "0")" />
    <input type="hidden" name="Pedido.IdEstadopedido" value="1" /> <!-- 1 = Solicitado -->
    <!-- Datos de ejemplo para el detalle, ajusta según necesites -->
    <input type="hidden" name="DetallePedido.IdMenu" value="1" />
    <input type="hidden" name="DetallePedido.DetCantidad" value="1" />
    <input type="hidden" name="DetallePedido.IdEstadopedido" value="1" />
</form>

<div class="text-center mt-5">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
    <p>Preparando pedido para la mesa @idMesa...</p>
</div>